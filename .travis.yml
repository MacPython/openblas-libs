env:
    global:
        # The archive that gets built has name from ``git describe`` on this
        # commit.
        - OPENBLAS_COMMIT: "v0.3.30"

dist: jammy
services: docker

jobs:
  include:
    - os: linux
      arch: s390x
      env:
        - PLAT=s390x
        - MB_ML_VER=2014
        - INTERFACE64=0
    - os: linux
      arch: s390x
      env:
        - PLAT=s390x
        - INTERFACE64=1
        - MB_ML_VER=2014
    - os: linux
      arch: ppc64le
      env:
        - PLAT=ppc64le
        - MB_ML_VER=2014
        - INTERFACE64=0
    - os: linux
      arch: ppc64le
      env:
        - PLAT=ppc64le
        - INTERFACE64=1
        - MB_ML_VER=2014

install:
    # Maybe get and clean and patch source
    - |
      python3 -m pip install cibuildwheel==3.2.1
      python3 -m cibuildwheel --help # make sure it is installed correctly
      echo done install step

script:
    - |
      export CIBW_BUILD="cp39-manylinux_${PLAT}"
      export CIBW_MANYLINUX_S390X_IMAGE="manylinux${MB_ML_VER}"
      export CIBW_MANYLINUX_PPC64LE_IMAGE="manylinux${MB_ML_VER}"

      python3 -m cibuildwheel --print-build-identifiers

      python3 -m cibuildwheel --output-dir dist

after_success:
    - set +ex
    - sudo chmod -R a+w /home/travis/.cache
    - pip install -q git+https://github.com/Anaconda-Platform/anaconda-client@1.13.0
    # Upload libraries to the shared staging area on anaconda.org
    - sudo chmod -R a+w dist
    - source tools/upload_to_anaconda_staging.sh
    - upload_wheels
