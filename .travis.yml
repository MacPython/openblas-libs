env:
    global:
        # The archive that gets built has name from ``git describe`` on this
        # commit.
        - OPENBLAS_COMMIT: "v0.3.30"

dist: jammy
services: docker

jobs:
  include:
    - os: linux
      arch: s390x
      env:
        - PLAT=s390x
        - MB_ML_VER=2014
        - INTERFACE64=0
    - os: linux
      arch: s390x
      env:
        - PLAT=s390x
        - INTERFACE64=1
        - MB_ML_VER=2014
    - os: linux
      arch: ppc64le
      env:
        - PLAT=ppc64le
        - MB_ML_VER=2014
        - INTERFACE64=0
    - os: linux
      arch: ppc64le
      env:
        - PLAT=ppc64le
        - INTERFACE64=1
        - MB_ML_VER=2014

install:
    # Maybe get and clean and patch source
    - pip install cibuildwheel -v
    - which cibuildwheel
    - cibuildwheel --help # make sure it is installed correctly
    - echo done install step

script:
    - CIBW_BUILD="cp39-manylinux_${PLAT}"
    - CIBW_MANYLINUX_S390X_IMAGE="manylinux${MB_ML_VER}"
    - CIBW_MANYLINUX_PPC64LE_IMAGE="manylinux${MB_ML_VER}"
    
    - echo "Building for PLAT=${PLAT}, INTERFACE64=${INTERFACE64}, MB_ML_VER=${MB_ML_VER}, CIBW_BUILD=${CIBW_BUILD}, CIBW_MANYLINUX_S390X_IMAGE=${CIBW_MANYLINUX_S390X_IMAGE}, CIBW_MANYLINUX_PPC64LE_IMAGE=${CIBW_MANYLINUX_PPC64LE_IMAGE}"

    - cibuildwheel --print-build-identifiers

    - cibuildwheel --output-dir dist

after_success:
    - set +ex
    - sudo chmod -R a+w /home/travis/.cache
    - pip install -q git+https://github.com/Anaconda-Platform/anaconda-client@1.13.0
    # Upload libraries to the shared staging area on anaconda.org
    - sudo chmod -R a+w dist
    - source tools/upload_to_anaconda_staging.sh
    - upload_wheels
